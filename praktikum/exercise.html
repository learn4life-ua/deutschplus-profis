<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Вправа — Deutsch+Profis</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
:root{--green:#009846;--green-light:#e6f5f0;--dark:#1f2937;--muted:#6b7280;--bg:#f9fafb;--card:#fff;--border:#e5e7eb;--radius:16px;--shadow:0 4px 6px -1px rgba(0,0,0,.03),0 2px 4px -2px rgba(0,0,0,.03);}
body{margin:0;background:var(--bg);color:#374151;font-family:'Inter',system-ui,sans-serif;line-height:1.6;}
.wrap{max-width:900px;margin:0 auto;padding:0 clamp(16px,5vw,24px);box-sizing:border-box;}
.main-nav{position:sticky;top:16px;margin:16px clamp(16px,5vw,24px) 0;background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:16px;padding:12px 24px;box-shadow:var(--shadow);z-index:10;}
.nav-content{display:flex;align-items:center;justify-content:space-between}
.logo{display:flex;gap:8px;font-weight:800;color:var(--dark);text-decoration:none}
.page{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:clamp(24px,5vw,40px);margin:24px 0;}
h1{text-align:center;color:var(--dark);font-size:clamp(28px,4vw,36px);margin:0 0 8px}
.lead{text-align:center;color:var(--muted);margin:0 auto 24px;max-width:600px}
.section{border-top:1px solid var(--border);padding-top:16px;margin-top:16px}
label{font-weight:600}
input,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--bg);font:inherit}
.inline{display:inline-block;width:180px;margin:0 8px}
.btn{display:inline-flex;align-items:center;gap:8px;background:var(--green);color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:700;cursor:pointer}
.badge{background:var(--green-light);color:#065f46;border:1px solid var(--green);border-radius:999px;padding:2px 8px;font-size:12px;font-weight:700}
.meta{color:var(--muted);font-style:italic;background:var(--bg);padding:8px 12px;border-radius:10px}
</style>
</head>
<body>
<nav class="main-nav">
  <div class="nav-content">
    <a href="index.html" class="logo">Deutsch<span style="color:var(--green)">+</span>Profis</a>
  </div>
</nav>
<main class="wrap">
  <div class="page">
    <h1 id="title">Вправа</h1>
    <p class="lead">Переклад, словничок і запитання на розуміння</p>

    <div class="section">
      <h3>1. Текст для перекладу <span class="badge" id="translateBadge"></span></h3>
      <div id="germanText" class="meta"></div>
      <p id="explain" class="meta" style="margin-top:8px"></p>
      <textarea id="answer" rows="6" placeholder="Введіть свій переклад тут..."></textarea>
      <p><button class="btn" id="check">Перевірити переклад</button></p>
      <div id="solution" style="display:none">
        <h4>Зразок перекладу</h4>
        <div class="meta" id="correct"></div>
      </div>
    </div>

    <div class="section">
      <h3>2. Словникові вправи <span class="badge" id="vocabBadge"></span></h3>
      <div id="vocab"></div>
      <p><button class="btn" id="checkVocab">Перевірити словник</button></p>
    </div>

    <div class="section">
      <h3>3. Розуміння</h3>
      <h4>3.1 Доповніть речення</h4>
      <div id="fill"></div>
      <h4>3.2 Відповіді на запитання</h4>
      <div id="qa"></div>
      <p><button class="btn" id="checkComp">Перевірити розуміння</button></p>
      <div id="compScores" class="meta" style="display:none"></div>
    </div>
  </div>
</main>
<script>
const params = new URLSearchParams(location.search);
const v = (params.get('v')||'01').padStart(2,'0');

const embedded = {
  "01": {"title": "Das Maschinensystem für die Tierproduktion", "germanText": "Zu einem einheitlichen Maschinensystem für Produktionsanlagen der Rinder- und Schweinehaltung gehören die Teilmaschinensysteme für: 1) Fütterung, 2) Entmistung, Reinigung und Desinfektion, 3) Melken.<br><br>Das Teilmaschinensystem der Fütterung umfaßt die Arbeitsgänge von der Entnahme des Futters aus dem Lager bis zur Verabreichung der gewünschten Futterration am Tierplatz. Dazu werden Futteraufbereitungsanlagen, Selbsttränken und andere Einrichtungen angewendet.<br><br>Die mechanisierte Aufbereitung des Futters befaßt sich zum Beispiel mit der Reinigung von Hackfrüchten, dem Zerkleinern von Grünfutter und Hackfrüchten.<br><br>Das Teilmaschinensystem für die Entmistung. Для die Entmistung von Ställen mit Einstreu können stationäre Anlagen und der Traktor mit Frontlader als mobiles technisches Arbeitsmittel eingesetzt werden. Einstreulose Ställe kann man hydromechanisch entmisten.<br><br>Das Teilmaschinensystem für das Melken in industriemäßig produzierenden Anlagen basiert auf Rohrmelkanlage und Karusselmelkstand.<br><br>Die Mechanisierung des Entmistens und des Melkens hat bereits einen hohen Stand erreicht.", "explanation": "sich befassen mit (D) — займатися чим-небудь", "correctTranslation": "Машинна система для тваринництва\nДо єдиної машинної системи для виробничих установ великої рогатої худоби та свинарства входять часткові машинні системи для: годівлі; прибирання гною, очищення та дезінфекції; доїння.\nЧасткова машинна система годівлі охоплює всі операції — від вилучення корму зі сховища до подачі необхідної порції корму на місце утримання тварин. Для цього використовуються установки для підготовки кормів, автопоїлки та інше обладнання.\nМеханізована підготовка кормів передбачає, наприклад, очищення коренеплодів, подрібнення зелених кормів та коренеплодів.\nЧасткова машинна система прибирання гною. Для очищення приміщень із підстилкою можуть використовуватись стаціонарні установки або трактор із фронтальним навантажувачем як мобільний технічний засіб. Приміщення без підстилки можна очищувати гідромеханічним способом.\nЧасткова машинна система доїння в промислових умовах базується на трубопровідних доїльних установках та доїльних каруселях.\nМеханізація прибирання гною та доїння вже досягла високого рівня розвитку.", "vocabulary": [{"word": "sich befassen (mit)", "answer": "займатися чим-небудь"}, {"word": "die Einrichtung", "answer": "обладнання, устаткування"}, {"word": "die Einstreu", "answer": "підстилка"}, {"word": "die Hackfrucht", "answer": "просапна культура"}, {"word": "die Reinigung", "answer": "очищення"}, {"word": "der Stall", "answer": "корівник, стайня"}, {"word": "der Stand", "answer": "рівень, стан"}, {"word": "die Verabreichung", "answer": "видача, подача"}], "comprehension3_1": [{"textParts": ["1) Zur Entmistung der ", "INPUT", " mit ", "INPUT", " wird der Traktor mit Frontlader eingesetzt."], "answers": ["Ställe", "Einstreu"]}, {"textParts": ["2) Die mechanisierte Futteraufbereitung ", "INPUT", " mit der Reinigung von Hackfrüchten und dem Zerkleinern von Grünfutter."], "answers": ["befaßt sich"]}, {"textParts": ["3) Die Mechanisierung solcher Arbeitsgänge wie Entmisten und ", "INPUT", " hat einen hohen ", "INPUT", " erreicht."], "answers": ["Melken", "Stand"]}], "comprehension3_2": [{"question": "1) Welche Teilmaschinensysteme gehören zum Maschinensystem für Rinder- und Schweinehaltung?", "answer": "Zu einem einheitlichen Maschinensystem gehören die Teilmaschinensysteme für Fütterung; Entmistung, Reinigung und Desinfektion; Melken."}, {"question": "2) Wie kann man einstreulose Ställe entmisten?", "answer": "Einstreulose Ställe kann man hydromechanisch entmisten."}, {"question": "3) Welche Arbeitsgänge haben den höchsten Stand der Mechanisierung?", "answer": "Entmisten und Melken."}]}
};

function $(s){return document.querySelector(s)}
function esc(s){return (s||'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

async function loadData(v){
  const url = `data/${v}.json`;
  try{
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    return await res.json();
  }catch(e){
    console.warn('Не вдалося завантажити', url, e.message);
    return embedded[v] || null;
  }
}

function render(data){
  if(!data){ $('#title').textContent='Дані не знайдено'; return;}
  $('#title').textContent = data.title || 'Вправа';
  $('#germanText').innerHTML = data.germanText || '';
  $('#explain').textContent = data.explanation || '';

  $('#vocab').innerHTML = (data.vocabulary||[]).map((it,i)=>
   `<div style="margin:8px 0">
      <label>${esc(it.word)}</label>
      <input data-answer="${esc(it.answer)}" class="v-inp" placeholder="Український відповідник">
    </div>`).join('');

  $('#fill').innerHTML = (data.comprehension3_1||[]).map(item=>{
    let i=0;
    const html = item.textParts.map(p=> p==="INPUT" ? `<input class="inline c31" data-answer="${esc(item.answers[i++])}">` : esc(p)).join('');
    return `<p>${html}</p>`;
  }).join('');

  $('#qa').innerHTML = (data.comprehension3_2||[]).map(item=>
    `<div style="margin:8px 0">
      <label>${esc(item.question)}</label>
      <textarea rows="2" class="c32" data-answer="${esc(item.answer)}"></textarea>
    </div>`).join('');
}

function normalize(s){return (s||'').toLowerCase().replaceAll('ß','ss').normalize('NFKD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();}

document.getElementById('check').addEventListener('click',()=>{
  document.getElementById('solution').style.display='block';
  document.getElementById('correct').textContent = (embedded['01'] && v==='01' ? embedded['01'].correctTranslation : 'Перегляньте методичку для зразка перекладу.');
});

document.getElementById('checkVocab').addEventListener('click',()=>{
  const inputs = document.querySelectorAll('.v-inp');
  let ok=0;
  inputs.forEach(inp=>{
    const u = normalize(inp.value);
    const golds = inp.dataset.answer.split(',').map(a=>normalize(a));
    if(golds.some(g=>u===g || (u && (u.includes(g)||g.includes(u))))) ok++;
  });
  const score = inputs.length? Math.round(ok/inputs.length*100):0;
  document.getElementById('vocabBadge').textContent = score+'%';
});

document.getElementById('checkComp').addEventListener('click',()=>{
  const c31 = document.querySelectorAll('.c31');
  let ok31=0;
  c31.forEach(i=>{ if(normalize(i.value)===normalize(i.dataset.answer)) ok31++; });
  const s31 = c31.length? Math.round(ok31/c31.length*100):0;

  const c32 = document.querySelectorAll('.c32');
  let ok32=0;
  c32.forEach(t=>{
    const said = normalize(t.value).split(/[^a-zа-щьюяїієґ0-9-]+/).filter(w=>w.length>=4);
    const gold = normalize(t.dataset.answer).split(/[^a-zа-щьюяїієґ0-9-]+/).filter(w=>w.length>=4);
    const hits = said.filter(w=>gold.includes(w)).length;
    if(said.length && hits>=Math.min(2,gold.length)) ok32++;
  });
  const s32 = c32.length? Math.round(ok32/c32.length*100):0;

  document.getElementById('compScores').style.display='block';
  document.getElementById('compScores').textContent = `3.1: ${s31}% • 3.2: ${s32}%`;
});

loadData(v).then(render);
</script>
</body>
</html>
